<!DOCTYPE html>
<html>
  <head>
    <title></title>
    <style>
      #map {
        height: 100%;
      }
      .sampleConfig {
        width: 90%;
        height: 18%;
        margin-left: 15px;
      }
      #config {
        width: 90%;
        height: 20%;
        margin-left: 15px;
      }
      .buttons {
        padding: 15px;
      }
      .info {
        padding: 15px;
      }
      html,
      body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
    </style>
  </head>
  <body>
    <h1>STEP 1</h1>
    <h2>Set config:</h2>
    <p class="info">
      For the map below to show, you must replace YOUR_API_KEY in this
      index.html file with a Google Maps API key. After clicking any of these
      buttons, click anywhere on the map to set the coordinates for that value.
      Make sure to set the waypoints in the desired order.
    </p>
    <div class="buttons">
      <button id="originButton" onclick="addOrigin()">Set origin</button>
      <button id="destinationButton" onclick="addDestination()">
        Set destination
      </button>
      <button id="waypointButton" onclick="addWaypoint()">
        Add a waypoint
      </button>
    </div>
    <textarea id="config">
{
    "travelMode": "DRIVING"
}</textarea
    >
    <p class="info">
      Make sure you have at least an origin and destination set above. Then,
      copy the above config to your clipboard and proceed to step 2, pasting the
      config into step 2's text area.
    </p>
    <h2>Sample config:</h2>
    <textarea class="sampleConfig">
{
  "origin": "43.64343846608529, -79.37936672221016",
  "destination": "43.6847566291653, -79.41123962402344",
  "waypoints": [
      {
          "location": "43.67085166460574, -79.29862976074219"
      },
    
      {
          "location": "43.69716905314007, -79.29759979248047"
      }
    
    ],
    "travelMode": "DRIVING"
}</textarea
    >

    <div id="map"></div>
    <script>
      let map;
      let mapListener;

      let originMarker;
      let destinationMarker;
      let waypointMarkers = [];

      function initMap() {
        map = new google.maps.Map(document.getElementById("map"), {
          center: { lat: -34.397, lng: 150.644 },
          zoom: 8,
        });
      }

      function addOrigin() {
        // Remove current origin marker
        if (originMarker) {
          originMarker.setMap(null);
        }

        document.getElementById("originButton").disabled = true;

        // Add new origin marker
        mapListener = map.addListener("click", function (e) {
          console.log(e);
          originMarker = new google.maps.Marker({
            map: map,
            position: e.latLng,
          });
          updateConfig();
          google.maps.event.removeListener(mapListener);
          document.getElementById("originButton").disabled = false;
        });
      }

      function addDestination() {
        // Remove current destination marker
        if (destinationMarker) {
          destinationMarker.setMap(null);
        }

        document.getElementById("destinationButton").disabled = true;

        // Add new destination marker
        mapListener = map.addListener("click", function (e) {
          console.log(e);
          destinationMarker = new google.maps.Marker({
            map: map,
            position: e.latLng,
          });
          updateConfig();
          google.maps.event.removeListener(mapListener);
          document.getElementById("destinationButton").disabled = false;
        });
      }

      function addWaypoint() {
        document.getElementById("waypointButton").disabled = true;

        // Add new waypoint marker
        mapListener = map.addListener("click", function (e) {
          let newWaypointMarker;
          console.log(e);
          newWaypointMarker = new google.maps.Marker({
            map: map,
            position: e.latLng,
          });
          waypointMarkers.push(newWaypointMarker);
          updateConfig();
          google.maps.event.removeListener(mapListener);
          document.getElementById("waypointButton").disabled = false;
        });
      }

      function updateConfig() {
        let originCoords;
        let destinationCoords;
        let waypointCoords;

        if (originMarker) {
          originCoords =
            originMarker.getPosition().lat() +
            ", " +
            originMarker.getPosition().lng();
        }
        if (destinationMarker) {
          destinationCoords =
            destinationMarker.getPosition().lat() +
            ", " +
            destinationMarker.getPosition().lng();
        }

        if (waypointMarkers.length > 0) {
          waypointCoords = `"waypoints": [`;

          waypointMarkers.forEach((marker, i) => {
            if (i + 1 != waypointMarkers.length) {
              let newWaypointString = `
        {
            "location": "${
              marker.getPosition().lat() + ", " + marker.getPosition().lng()
            }"
        },
      `;
              waypointCoords += newWaypointString;
            } else {
              let newWaypointString = `
        {
            "location": "${
              marker.getPosition().lat() + ", " + marker.getPosition().lng()
            }"
        }
      `;
              waypointCoords += newWaypointString;
            }
          });

          waypointCoords += `
    ],`;
        }

        document.getElementById("config").textContent = `{
    ${originCoords ? `"origin": "${originCoords}",` : ""}
    ${destinationCoords ? `"destination": "${destinationCoords}",` : ""}
    ${waypointMarkers.length > 0 ? waypointCoords : ""}
    "travelMode": "DRIVING"
}`;
      }
    </script>
    <script
      async
      defer
      src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&callback=initMap"
    ></script>
  </body>
</html>
